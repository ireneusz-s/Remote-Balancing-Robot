#include "cli.h"
#include "string.h"
#include "usart.h"
#include "FreeRTOS.h"
#include <stdlib.h>  
#include "task.h"
#include "stdbool.h"
#include "commands.h"
#include <math.h>
//#include "mpu6050.h"
#include "tim.h"
#include "IS_complementaryFilter.h"
#include "IS_PID.h"

extern xTaskHandle DataSendLVHandle;


extern uint8_t SampleRate;
extern bool DeviceOn;

extern int32_t SM_Move_Var;
extern int32_t SM_Turn_Var;


extern IS_CompFilter_struct CompFilter_Data;
extern IS_PID_struct PID1_Data;
extern IS_PID_struct PID2_Data;

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandLED(char *args)
{
  if(strcmp(args, "on") == 0)
	{
    // turn the LED on
    HAL_GPIO_WritePin(GPIOG, GPIO_PIN_14, GPIO_PIN_SET);
		USART_WriteString("RED LED ON\n");
    }
		else if(strcmp(args, "off") == 0)
		{
      // turn the LED off
      HAL_GPIO_WritePin(GPIOG, GPIO_PIN_14, GPIO_PIN_RESET);
			USART_WriteString("RED LED OFF\n");
    }
		else 
		{
      USART_WriteString("Unrecognized argument. Available arguments are \"on\" and \"off\"\n\r");
    }
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID_Kp(char *args)
{
	PID1_Data.PID_KP = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID_Ki(char *args)
{
	PID1_Data.PID_KI = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID_Kd(char *args)
{
	PID1_Data.PID_KD = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID_AntiWindup(char *args)
{
	PID1_Data.PID_AntiWindup = atoi(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void commandPID2_Kp(char *args)
{
	PID2_Data.PID_KP = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID2_Ki(char *args)
{
	PID2_Data.PID_KI = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID2_Kd(char *args)
{
	PID2_Data.PID_KD = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandPID2_AntiWindup(char *args)
{
	PID2_Data.PID_AntiWindup = atoi(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void commandOffset_Ang(char *args)
{
	CompFilter_Data.OffsetAngleDynamic = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandCF_A(char *args)
{
	//USART_WriteString("TEST2\n");
	CompFilter_Data.A = atof(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandSampleRate(char *args)
{
	//USART_WriteString("TEST2\n");
	SampleRate = atoi(args);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void commandDeviceOn(char *args)
{
  if(strcmp(args, "on") == 0)
	{
		DeviceOn=true;
  }
	else if(strcmp(args, "off") == 0)
	{
		DeviceOn=false;
  }
	else if(strcmp(args, "onLV") == 0)
	{
		DeviceOn=true;
		vTaskResume(DataSendLVHandle);
  }
	else if(strcmp(args, "offLV") == 0)
	{
		DeviceOn=false;
		vTaskSuspend(DataSendLVHandle);
  }
	else 
	{
    USART_WriteString("Unrecognized argument. Available arguments are \"on\" and \"off\"\n\r");
  }
}
	
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void commandSM_Move(char *args)
{
	int32_t speed;
  speed = atoi(args);
	SM_Move_Var=speed;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void commandSM_Turn(char *args)
{
	int32_t turn;
  turn = atoi(args);
	SM_Turn_Var=turn;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
